Namespace Access

  Public Class ContactAddress
    Inherits CARERecord

#Region "AutoGenerated Code"

    '--------------------------------------------------
    'Enum defining all the fields in the table
    '--------------------------------------------------
    Private Enum ContactAddressFields
      AllFields = 0
      ContactNumber
      AddressLinkNumber
      AddressNumber
      Historical
      ValidFrom
      ValidTo
      AmendedBy
      AmendedOn
    End Enum

    '--------------------------------------------------
    'Required overrides for the class
    '--------------------------------------------------
    Protected Overrides Sub AddFields()
      With mvClassFields
        .Add("contact_number", CDBField.FieldTypes.cftLong)
        .Add("address_link_number", CDBField.FieldTypes.cftLong)
        .Add("address_number", CDBField.FieldTypes.cftLong)
        .Add("historical")
        .Add("valid_from", CDBField.FieldTypes.cftDate)
        .Add("valid_to", CDBField.FieldTypes.cftDate)

        .Item("address_link_number").PrimaryKey = True
        .Item("address_number").PrefixRequired = True
        .Item("contact_number").PrefixRequired = True
        .SetControlNumberField(ContactAddressFields.AddressLinkNumber, "AL")
      End With
    End Sub

    Protected Overrides ReadOnly Property SupportsAmendedOnAndBy() As Boolean
      Get
        Return True
      End Get
    End Property
    Protected Overrides ReadOnly Property TableAlias() As String
      Get
        Return "ca"
      End Get
    End Property
    Protected Overrides ReadOnly Property DatabaseTableName() As String
      Get
        Return "contact_addresses"
      End Get
    End Property

    '--------------------------------------------------
    'Default constructor
    '--------------------------------------------------
    Public Sub New(ByVal pEnv As CDBEnvironment)
      MyBase.New(pEnv)
    End Sub

    '--------------------------------------------------
    'Public property procedures
    '--------------------------------------------------
    Public ReadOnly Property AddressLinkNumber() As Integer
      Get
        Return mvClassFields(ContactAddressFields.AddressLinkNumber).IntegerValue
      End Get
    End Property
    Public Property AddressNumber() As Integer
      Get
        Return mvClassFields(ContactAddressFields.AddressNumber).IntegerValue
      End Get
      Set(ByVal Value As Integer)
        mvClassFields.Item(ContactAddressFields.AddressNumber).IntegerValue = Value
      End Set
    End Property
    Public ReadOnly Property ContactNumber() As Integer
      Get
        Return mvClassFields(ContactAddressFields.ContactNumber).IntegerValue
      End Get
    End Property
    Public Property Historical() As Boolean
      Get
        Return mvClassFields(ContactAddressFields.Historical).Bool
      End Get
      Set(ByVal value As Boolean)
        mvClassFields(ContactAddressFields.Historical).Bool = value
      End Set
    End Property
    Public Property ValidFrom() As String
      Get
        Return mvClassFields(ContactAddressFields.ValidFrom).Value
      End Get
      Set(ByVal value As String)
        mvClassFields(ContactAddressFields.ValidFrom).Value = value
      End Set
    End Property
    Public Property ValidTo() As String
      Get
        Return mvClassFields(ContactAddressFields.ValidTo).Value
      End Get
      Set(ByVal value As String)
        mvClassFields(ContactAddressFields.ValidTo).Value = value
      End Set
    End Property
    Public Property AmendedBy() As String
      Get
        Return mvClassFields(ContactAddressFields.AmendedBy).Value
      End Get
      Set(ByVal value As String)
        mvClassFields(ContactAddressFields.AmendedBy).Value = value
      End Set
    End Property
    Public ReadOnly Property AmendedOn() As String
      Get
        Return mvClassFields(ContactAddressFields.AmendedOn).Value
      End Get
    End Property
#End Region

#Region "Non AutoGenerated Code"

    Private mvAddress As Address
    Private mvHistoricalChanged As Boolean

    Protected Overrides Sub ClearFields()
      mvAddress = Nothing
      mvHistoricalChanged = False
    End Sub

    Protected Overrides Sub SetDefaults()
      MyBase.SetDefaults()
      mvClassFields.Item(ContactAddressFields.Historical).Bool = False
      mvClassFields.Item(ContactAddressFields.ValidFrom).Value = TodaysDate()
    End Sub

    Public Overloads Sub Init(ByVal pContactNumber As Integer, ByVal pAddressNumber As Integer)
      MyBase.Init()
      Dim vWhereFields As New CDBFields()
      vWhereFields.Add(mvClassFields(ContactAddressFields.ContactNumber).Name, pContactNumber)
      vWhereFields.Add(mvClassFields(ContactAddressFields.AddressNumber).Name, pAddressNumber)
      InitWithPrimaryKey(vWhereFields)
    End Sub

    Public Overloads Sub Create(ByVal pContactNumber As Integer, ByVal pAddressNumber As Integer, ByVal pHistorical As String, ByVal pValidFrom As String, ByVal pValidTo As String)
      Create(pContactNumber, pAddressNumber)
      mvClassFields(ContactAddressFields.Historical).Value = pHistorical
      mvClassFields(ContactAddressFields.ValidFrom).Value = pValidFrom
      mvClassFields(ContactAddressFields.ValidTo).Value = pValidTo
    End Sub

    Public Overloads Sub Create(ByVal pContactNumber As Integer, ByVal pAddressNumber As Integer)
      Init()
      mvClassFields(ContactAddressFields.ContactNumber).IntegerValue = pContactNumber
      mvClassFields(ContactAddressFields.AddressNumber).IntegerValue = pAddressNumber
    End Sub

    Public Property Address() As Address
      Get
        ' BR11482/PP1165 - if we dont have an instantiated address object, we need to get one
        If mvAddress Is Nothing Then
          mvAddress = New Address(mvEnv)
          mvAddress.Init(AddressNumber)
        End If
        Return mvAddress
      End Get
      Set(ByVal Value As Address)
        mvAddress = Value
      End Set
    End Property

    Public Sub SetAmended(ByVal pAmendedOn As String, ByVal pAmendedBy As String)
      mvClassFields(ContactAddressFields.AmendedOn).Value = pAmendedOn
      mvClassFields(ContactAddressFields.AmendedBy).Value = pAmendedBy
      If pAmendedBy.Length > 0 AndAlso pAmendedOn.Length > 0 Then mvOverrideAmended = True
    End Sub

    Public Overloads Sub Clone(ByVal pRecord As CARERecord, ByVal pNewContactNumber As Integer)
      'For an OrganisationAddress, the primay key gets changed from AddressLinkNumber to OrganisationNumber.
      'AddressLinkNumber should be set to 0 to get a new control number and OrganisationNumber (ContactNumber) should be the new organisation number.
      MyBase.Clone(pRecord)
      mvClassFields(ContactAddressFields.ContactNumber).IntegerValue = pNewContactNumber
      mvClassFields(ContactAddressFields.AddressLinkNumber).IntegerValue = 0
    End Sub
#End Region

  End Class
End Namespace
