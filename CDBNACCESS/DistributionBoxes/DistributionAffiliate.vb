Namespace Access
  Public Class DistributionAffiliate
    Inherits CARERecord

#Region "AutoGenerated Code"

    '--------------------------------------------------
    'Enum defining all the fields in the table
    '--------------------------------------------------
    Private Enum DistributionAffiliateFields
      AllFields = 0
      DistributionAffiliate
      DistributionAffiliateDesc
      CurrencyCode
      NextBoxNumber
      BoxPrice
      Product
      AmendedBy
      AmendedOn
    End Enum

    Protected Overrides Sub AddFields()
      With mvClassFields
        .Add("distribution_affiliate")
        .Add("distribution_affiliate_desc")
        .Add("currency_code")
        .Add("next_box_number", CDBField.FieldTypes.cftLong)
        .Add("box_price", CDBField.FieldTypes.cftNumeric)
        .Add("product")

        .Item(DistributionAffiliateFields.DistributionAffiliate).PrimaryKey = True
      End With
    End Sub

    Protected Overrides ReadOnly Property SupportsAmendedOnAndBy() As Boolean
      Get
        Return True
      End Get
    End Property

    Protected Overrides ReadOnly Property TableAlias() As String
      Get
        Return "da"
      End Get
    End Property

    Protected Overrides ReadOnly Property DatabaseTableName() As String
      Get
        Return "distribution_affiliates"
      End Get
    End Property

    '--------------------------------------------------
    'Default constructor
    '--------------------------------------------------
    Public Sub New(ByVal pEnv As CDBEnvironment)
      MyBase.New(pEnv)
    End Sub

    '--------------------------------------------------
    'Public property procedures
    '--------------------------------------------------
    Public ReadOnly Property AmendedBy() As String
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.AmendedBy).Value
      End Get
    End Property

    Public ReadOnly Property AmendedOn() As String
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.AmendedOn).Value
      End Get
    End Property

    Public ReadOnly Property BoxPrice() As Double
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.BoxPrice).DoubleValue
      End Get
    End Property

    Public ReadOnly Property CurrencyCode() As String
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.CurrencyCode).Value
      End Get
    End Property

    Public ReadOnly Property DistributionAffiliateCode() As String
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.DistributionAffiliate).Value
      End Get
    End Property

    Public ReadOnly Property DistributionAffiliateDesc() As String
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.DistributionAffiliateDesc).Value
      End Get
    End Property

    Public ReadOnly Property NextBoxNumber() As Integer
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.NextBoxNumber).IntegerValue
      End Get
    End Property

    Public ReadOnly Property Product() As String
      Get
        Return mvClassFields.Item(DistributionAffiliateFields.Product).Value
      End Get
    End Property
#End Region

#Region "Non-AutoGenerated Code"
    Public ReadOnly Property MaxBoxNumber() As Integer
      Get
        Dim vWhereFields As New CDBFields(New CDBField("distribution_affiliate", DistributionAffiliateCode))
        Dim vSQL As New SQLStatement(mvEnv.Connection, "MAX(box_number) AS max_box_number", "distribution_boxes db", vWhereFields)
        Return IntegerValue(vSQL.GetValue)
      End Get
    End Property

    Public Sub UpdateNextBoxNumber(ByVal pLastBoxNumber As Integer)
      'Include the current NextBoxNumber in the update statement just in case this process is run twice at the same time
      Dim vUpdateFields As New CDBFields
      Dim vWhereFields As New CDBFields

      vUpdateFields.Add("next_box_number", CDBField.FieldTypes.cftLong, pLastBoxNumber + 1)
      vWhereFields.Add("distribution_affiliate", CDBField.FieldTypes.cftCharacter, mvClassFields.Item(DistributionAffiliateFields.DistributionAffiliate).Value)
      vWhereFields.Add("next_box_number", CDBField.FieldTypes.cftLong, mvClassFields.Item(DistributionAffiliateFields.NextBoxNumber).LongValue)
      mvEnv.Connection.UpdateRecords((mvClassFields.DatabaseTableName), vUpdateFields, vWhereFields)
      mvClassFields.Item(DistributionAffiliateFields.NextBoxNumber).SetValue = CStr(pLastBoxNumber + 1)

    End Sub

#End Region

  End Class
End Namespace