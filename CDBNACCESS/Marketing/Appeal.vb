Namespace Access

  Public Class Appeal
    Inherits CARERecord

#Region "AutoGenerated Code"

'--------------------------------------------------
'Enum defining all the fields in the table
'--------------------------------------------------
    Private Enum AppealFields
      AllFields = 0
      Campaign
      Appeal
      AppealDesc
      MailingType
      RequiredCount
      ActualCount
      AppealDate
      Notes
      TargetIncome
      Locked
      ExpenditureGroup
      Manager
      AppealCostCentre
      AppealBusinessType
      Topic
      SubTopic
      TargetResponse
      VariableParameters
      OrgMailTo
      OrgMailWhere
      OrgMailRoles
      OrgMailAddrUsage
      OrgMailLabelName
      ThankYouLetter
      MailJoints
      MailJointsMethod
      JointStatusExclusions
      CombineMail
      BypassCount
      CreateMailingHistory
      ExpectedIncome
      GuaranteedIncome
      DefaultDespatchQuantity
      MasterAction
      TargetResponsePercentage
      DespatchMethod
      BudgetedCount
      Cost
      FixedCost
      ActualIncome
      ActualIncomeDate
      AppealType
      EndDate
      SegmentOrgSelectionOptions
      CollectionsSource
      CollectionsProduct
      CollectionsRate
      CollectionsBankAccount
      MinimumRollForwardIncome
      ReadyForConfirmation
      ReadyForAcknowledgement
      ConfirmationProducedOn
      LabelsProducedOn
      ResourcesProducedOn
      EndOfCollectionProducedOn
      AcknowledgementProducedOn
      ReminderProducedOn
      ActualCountDate
      TotalExpenditure
      ReturnOnInvestment
      TotalItemisedCost
      AmendedBy
      AmendedOn
    End Enum

'--------------------------------------------------
'Required overrides for the class
'--------------------------------------------------
    Protected Overrides Sub AddFields()
      With mvClassFields
        .Add("campaign")
        .Add("appeal")
        .Add("appeal_desc")
        .Add("mailing_type")
        .Add("required_count", CDBField.FieldTypes.cftLong)
        .Add("actual_count", CDBField.FieldTypes.cftLong)
        .Add("appeal_date", CDBField.FieldTypes.cftDate)
        .Add("notes", CDBField.FieldTypes.cftMemo)
        .Add("target_income", CDBField.FieldTypes.cftNumeric)
        .Add("locked")
        .Add("expenditure_group")
        .Add("manager")
        .Add("appeal_cost_centre")
        .Add("appeal_business_type")
        .Add("topic")
        .Add("sub_topic")
        .Add("target_response", CDBField.FieldTypes.cftLong)
        .Add("variable_parameters", CDBField.FieldTypes.cftMemo)
        .Add("org_mail_to")
        .Add("org_mail_where")
        .Add("org_mail_roles", CDBField.FieldTypes.cftMemo)
        .Add("org_mail_addr_usage")
        .Add("org_mail_label_name")
        .Add("thank_you_letter")
        .Add("mail_joints")
        .Add("mail_joints_method")
        .Add("joint_status_exclusions", CDBField.FieldTypes.cftMemo)
        .Add("combine_mail")
        .Add("bypass_count")
        .Add("create_mailing_history")
        .Add("expected_income", CDBField.FieldTypes.cftNumeric)
        .Add("guaranteed_income", CDBField.FieldTypes.cftNumeric)
        .Add("default_despatch_quantity", CDBField.FieldTypes.cftInteger)
        .Add("master_action", CDBField.FieldTypes.cftLong)
        .Add("target_response_percentage", CDBField.FieldTypes.cftNumeric)
        .Add("despatch_method")
        .Add("budgeted_count", CDBField.FieldTypes.cftLong)
        .Add("cost", CDBField.FieldTypes.cftNumeric)
        .Add("fixed_cost", CDBField.FieldTypes.cftNumeric)
        .Add("actual_income", CDBField.FieldTypes.cftNumeric)
        .Add("actual_income_date", CDBField.FieldTypes.cftDate)
        .Add("appeal_type")
        .Add("end_date", CDBField.FieldTypes.cftDate)
        .Add("segment_org_selection_options")
        .Add("collections_source")
        .Add("collections_product")
        .Add("collections_rate")
        .Add("collections_bank_account")
        .Add("minimum_roll_forward_income", CDBField.FieldTypes.cftNumeric)
        .Add("ready_for_confirmation")
        .Add("ready_for_acknowledgement")
        .Add("confirmation_produced_on", CDBField.FieldTypes.cftDate)
        .Add("labels_produced_on", CDBField.FieldTypes.cftDate)
        .Add("resources_produced_on", CDBField.FieldTypes.cftDate)
        .Add("end_of_collection_produced_on", CDBField.FieldTypes.cftDate)
        .Add("acknowledgement_produced_on", CDBField.FieldTypes.cftDate)
        .Add("reminder_produced_on", CDBField.FieldTypes.cftDate)
        .Add("actual_count_date", CDBField.FieldTypes.cftDate)
        .Add("total_expenditure", CDBField.FieldTypes.cftNumeric)
        .Add("return_on_investment", CDBField.FieldTypes.cftNumeric)
        .Add("total_itemised_cost", CDBField.FieldTypes.cftNumeric)

        .Item(AppealFields.Campaign).PrimaryKey = True
        .SetUniqueField(AppealFields.Campaign)
        .SetUniqueField(AppealFields.Appeal)

        .Item(AppealFields.Appeal).PrimaryKey = True
        .Item(AppealFields.TotalExpenditure).InDatabase = mvEnv.GetDataStructureInfo(CDBEnvironment.cdbDataStructureConstants.cdbDataAppealExpenditureROI)
        .Item(AppealFields.ReturnOnInvestment).InDatabase = .Item(AppealFields.TotalExpenditure).InDatabase
        .Item(AppealFields.TotalItemisedCost).InDatabase = mvEnv.GetDataStructureInfo(CDBEnvironment.cdbDataStructureConstants.cdbDataCampaignItemisedCosts)
      End With
    End Sub

    Protected Overrides ReadOnly Property SupportsAmendedOnAndBy() As Boolean
      Get
        Return True
      End Get
    End Property
    Protected Overrides ReadOnly Property TableAlias() As String
      Get
        Return "ap"
      End Get
    End Property
    Protected Overrides ReadOnly Property DatabaseTableName() As String
      Get
        Return "appeals"
      End Get
    End Property

'--------------------------------------------------
'Default constructor
'--------------------------------------------------
    Public Sub New(ByVal pEnv As CDBEnvironment)
      MyBase.New(pEnv)
    End Sub

'--------------------------------------------------
'Public property procedures
'--------------------------------------------------
    Public ReadOnly Property Campaign() As String
      Get
        Return mvClassFields(AppealFields.Campaign).Value
      End Get
    End Property
    Public ReadOnly Property AppealCode() As String
      Get
        Return mvClassFields(AppealFields.Appeal).Value
      End Get
    End Property
    Public ReadOnly Property AppealDesc() As String
      Get
        Return mvClassFields(AppealFields.AppealDesc).Value
      End Get
    End Property
    Public ReadOnly Property MailingType() As String
      Get
        Return mvClassFields(AppealFields.MailingType).Value
      End Get
    End Property

    Public ReadOnly Property RequiredCount() As String
      Get
        Return mvClassFields(AppealFields.RequiredCount).Value
      End Get
    End Property
    Public Property ActualCount() As String
      Get
        Return mvClassFields(AppealFields.ActualCount).Value
      End Get
      Set(ByVal Value As String)
        mvClassFields.Item(AppealFields.ActualCount).Value = Value
        mvClassFields.Item(AppealFields.ActualCountDate).Value = TodaysDate()
      End Set
    End Property
    Public ReadOnly Property AppealDate() As String
      Get
        Return mvClassFields(AppealFields.AppealDate).Value
      End Get
    End Property
    Public Property Notes() As String
      Get
        Return mvClassFields(AppealFields.Notes).Value
      End Get
      Set(ByVal value As String)
        mvClassFields(AppealFields.Notes).Value = value
      End Set
    End Property
    Public ReadOnly Property TargetIncome() As String
      Get
        Return mvClassFields(AppealFields.TargetIncome).Value
      End Get
    End Property
    Public ReadOnly Property Locked() As String
      Get
        Return mvClassFields(AppealFields.Locked).Value
      End Get
    End Property
    Public ReadOnly Property ExpenditureGroup() As String
      Get
        Return mvClassFields(AppealFields.ExpenditureGroup).Value
      End Get
    End Property
    Public ReadOnly Property Manager() As String
      Get
        Return mvClassFields(AppealFields.Manager).Value
      End Get
    End Property
    Public ReadOnly Property AppealCostCentre() As String
      Get
        Return mvClassFields(AppealFields.AppealCostCentre).Value
      End Get
    End Property
    Public ReadOnly Property AppealBusinessType() As String
      Get
        Return mvClassFields(AppealFields.AppealBusinessType).Value
      End Get
    End Property
    Public ReadOnly Property Topic() As String
      Get
        Return mvClassFields(AppealFields.Topic).Value
      End Get
    End Property
    Public ReadOnly Property SubTopic() As String
      Get
        Return mvClassFields(AppealFields.SubTopic).Value
      End Get
    End Property
    Public ReadOnly Property TargetResponse() As String
      Get
        Return mvClassFields(AppealFields.TargetResponse).Value
      End Get
    End Property
    Public ReadOnly Property VariableParameters() As String
      Get
        Return mvClassFields(AppealFields.VariableParameters).Value
      End Get
    End Property
    Public ReadOnly Property OrgMailTo() As String
      Get
        Return mvClassFields(AppealFields.OrgMailTo).Value
      End Get
    End Property
    Public ReadOnly Property OrgMailWhere() As String
      Get
        Return mvClassFields(AppealFields.OrgMailWhere).Value
      End Get
    End Property
    Public ReadOnly Property OrgMailRoles() As String
      Get
        Return mvClassFields(AppealFields.OrgMailRoles).Value
      End Get
    End Property
    Public ReadOnly Property OrgMailAddrUsage() As String
      Get
        Return mvClassFields(AppealFields.OrgMailAddrUsage).Value
      End Get
    End Property
    Public ReadOnly Property OrgMailLabelName() As String
      Get
        Return mvClassFields(AppealFields.OrgMailLabelName).Value
      End Get
    End Property
    Public ReadOnly Property ThankYouLetter() As String
      Get
        Return mvClassFields(AppealFields.ThankYouLetter).Value
      End Get
    End Property
    Public ReadOnly Property MailJoints() As Boolean
      Get
        Return mvClassFields(AppealFields.MailJoints).Bool
      End Get
    End Property
    Public ReadOnly Property MailJointsMethodCode() As String
      Get
        Return mvClassFields(AppealFields.MailJointsMethod).Value
      End Get
    End Property
    Public ReadOnly Property JointStatusExclusions() As String
      Get
        Return mvClassFields(AppealFields.JointStatusExclusions).Value
      End Get
    End Property
    Public ReadOnly Property CombineMail() As Boolean
      Get
        Return mvClassFields(AppealFields.CombineMail).Bool
      End Get
    End Property
    Public Property BypassCount() As Boolean
      Get
        Return mvClassFields(AppealFields.BypassCount).Bool
      End Get
      Set(ByVal value As Boolean)
        mvClassFields(AppealFields.BypassCount).Bool = value
      End Set
    End Property
    Public Property CreateMailingHistory() As Boolean
      Get
        Return mvClassFields(AppealFields.CreateMailingHistory).Bool
      End Get
      Set(ByVal value As Boolean)
        mvClassFields(AppealFields.CreateMailingHistory).Bool = value
      End Set
    End Property
    Public ReadOnly Property ExpectedIncome() As String
      Get
        Return mvClassFields(AppealFields.ExpectedIncome).Value
      End Get
    End Property
    Public ReadOnly Property GuaranteedIncome() As String
      Get
        Return mvClassFields(AppealFields.GuaranteedIncome).Value
      End Get
    End Property
    Public ReadOnly Property DefaultDespatchQuantity() As String
      Get
        Return mvClassFields(AppealFields.DefaultDespatchQuantity).Value
      End Get
    End Property
    Public ReadOnly Property AmendedOn() As String
      Get
        Return mvClassFields(AppealFields.AmendedOn).Value
      End Get
    End Property
    Public ReadOnly Property AmendedBy() As String
      Get
        Return mvClassFields(AppealFields.AmendedBy).Value
      End Get
    End Property
    Public ReadOnly Property MasterAction() As Integer
      Get
        Return mvClassFields(AppealFields.MasterAction).IntegerValue
      End Get
    End Property
    Public ReadOnly Property TargetResponsePercentage() As String
      Get
        Return mvClassFields(AppealFields.TargetResponsePercentage).Value
      End Get
    End Property
    Public ReadOnly Property DespatchMethod() As String
      Get
        Return mvClassFields(AppealFields.DespatchMethod).Value
      End Get
    End Property
    Public ReadOnly Property BudgetedCount() As String
      Get
        Return mvClassFields(AppealFields.BudgetedCount).Value
      End Get
    End Property
    Public ReadOnly Property Cost() As String
      Get
        Return mvClassFields(AppealFields.Cost).Value
      End Get
    End Property
    Public ReadOnly Property FixedCost() As String
      Get
        Return mvClassFields(AppealFields.FixedCost).Value
      End Get
    End Property
    Public ReadOnly Property ActualIncome() As Double
      Get
        Return mvClassFields(AppealFields.ActualIncome).DoubleValue
      End Get
    End Property
    Public ReadOnly Property ActualIncomeDate() As String
      Get
        Return mvClassFields(AppealFields.ActualIncomeDate).Value
      End Get
    End Property
    Public ReadOnly Property AppealType() As AppealTypes
      Get
        Return AppealTypeFromCode(mvClassFields(AppealFields.AppealType).Value)
      End Get
    End Property
    Public ReadOnly Property AppealTypeCode() As String
      Get
        Return mvClassFields(AppealFields.AppealType).Value
      End Get
    End Property
    Public ReadOnly Property EndDate() As String
      Get
        Return mvClassFields(AppealFields.EndDate).Value
      End Get
    End Property
    Public ReadOnly Property SegmentOrgSelectionOptions() As Boolean
      Get
        Return mvClassFields(AppealFields.SegmentOrgSelectionOptions).Bool
      End Get
    End Property
    Public ReadOnly Property CollectionsSource() As String
      Get
        Return mvClassFields(AppealFields.CollectionsSource).Value
      End Get
    End Property
    Public ReadOnly Property CollectionsProduct() As String
      Get
        Return mvClassFields(AppealFields.CollectionsProduct).Value
      End Get
    End Property
    Public ReadOnly Property CollectionsRate() As String
      Get
        Return mvClassFields(AppealFields.CollectionsRate).Value
      End Get
    End Property
    Public ReadOnly Property CollectionsBankAccount() As String
      Get
        Return mvClassFields(AppealFields.CollectionsBankAccount).Value
      End Get
    End Property
    Public ReadOnly Property MinimumRollForwardIncome() As String
      Get
        Return mvClassFields(AppealFields.MinimumRollForwardIncome).Value
      End Get
    End Property
    Public ReadOnly Property ReadyForConfirmation() As Boolean
      Get
        Return mvClassFields(AppealFields.ReadyForConfirmation).Bool
      End Get
    End Property
    Public ReadOnly Property ReadyForAcknowledgement() As Boolean
      Get
        Return mvClassFields(AppealFields.ReadyForAcknowledgement).Bool
      End Get
    End Property
    Public ReadOnly Property ConfirmationProducedOn() As String
      Get
        Return mvClassFields(AppealFields.ConfirmationProducedOn).Value
      End Get
    End Property
    Public ReadOnly Property LabelsProducedOn() As String
      Get
        Return mvClassFields(AppealFields.LabelsProducedOn).Value
      End Get
    End Property
    Public ReadOnly Property ResourcesProducedOn() As String
      Get
        Return mvClassFields(AppealFields.ResourcesProducedOn).Value
      End Get
    End Property
    Public ReadOnly Property EndOfCollectionProducedOn() As String
      Get
        Return mvClassFields(AppealFields.EndOfCollectionProducedOn).Value
      End Get
    End Property
    Public ReadOnly Property AcknowledgementProducedOn() As String
      Get
        Return mvClassFields(AppealFields.AcknowledgementProducedOn).Value
      End Get
    End Property
    Public ReadOnly Property ReminderProducedOn() As String
      Get
        Return mvClassFields(AppealFields.ReminderProducedOn).Value
      End Get
    End Property
    Public ReadOnly Property ActualCountDate() As String
      Get
        Return mvClassFields(AppealFields.ActualCountDate).Value
      End Get
    End Property
    Public ReadOnly Property TotalExpenditure() As Double
      Get
        Return mvClassFields.Item(AppealFields.TotalExpenditure).DoubleValue
      End Get
    End Property
    Public ReadOnly Property ReturnOnInvestment() As Double
      Get
        Return mvClassFields.Item(AppealFields.ReturnOnInvestment).DoubleValue
      End Get
    End Property
    Public ReadOnly Property TotalItemisedCost() As Double
      Get
        Return mvClassFields.Item(AppealFields.TotalItemisedCost).DoubleValue
      End Get
    End Property
#End Region

#Region "Non AutoGenerated Code"

    Public Enum AppealTypes
      aptySegmentedMailing
      aptyHouseToHouseCollection
      aptyMannedCollection
      aptyUnmannedCollection
    End Enum

    Protected Overrides Sub SetDefaults()
      mvClassFields(AppealFields.ReadyForAcknowledgement).Bool = False
      mvClassFields(AppealFields.ReadyForConfirmation).Bool = False
    End Sub

    Protected Overrides Sub SetValid()
      MyBase.SetValid()
      If AppealTypeCode.Length = 0 Then mvClassFields(AppealFields.AppealType).Value = "S"
    End Sub

    Public Shared Function AppealTypeFromCode(ByVal pAppealTypeCode As String) As AppealTypes
      Select Case pAppealTypeCode
        Case "H"
          Return AppealTypes.aptyHouseToHouseCollection
        Case "U"
          Return AppealTypes.aptyUnmannedCollection
        Case "M"
          Return AppealTypes.aptyMannedCollection
        Case Else '"S" or Null
          Return AppealTypes.aptySegmentedMailing
      End Select
    End Function
    Public Overrides Sub Delete(pAmendedBy As String, pAudit As Boolean, pJournalNumber As Integer)
      DeleteAssociatedData(Campaign, AppealCode)
      MyBase.Delete(pAmendedBy, pAudit, pJournalNumber)
    End Sub
    Public Sub DeleteAssociatedData(ByVal pCampaign As String)
      DeleteAssociatedData(pCampaign, "")
    End Sub
    Public Sub DeleteAssociatedData(ByVal pCampaign As String, pAppeal As String)
      Dim vMyTransaction As Boolean = mvEnv.Connection.StartTransaction()
      CheckClassFields()
      Dim vWhereFields As New CDBFields
      vWhereFields.Add(mvClassFields(AppealFields.Campaign).Name, pCampaign)
      If pAppeal.Length > 0 Then vWhereFields.Add(mvClassFields(AppealFields.Appeal).Name, pAppeal)
      mvEnv.Connection.DeleteRecords("segments", vWhereFields, False)
      mvEnv.Connection.DeleteRecords("appeal_budgets", vWhereFields, False)
      Dim vSegment As New Segment
      vSegment.Init(mvEnv)
      vSegment.DeleteAssociatedData(pCampaign, pAppeal)
      If vMyTransaction Then mvEnv.Connection.CommitTransaction()
    End Sub

    Public Overrides ReadOnly Property DataTable() As CDBDataTable
      Get
        Dim vDataTable As CDBDataTable = MyBase.DataTable
        vDataTable.Columns.Item("AppealBusinessType").Name = "BusinessType"
        vDataTable.Columns.Item("CollectionsSource").Name = "Source"
        vDataTable.Columns.Item("CollectionsProduct").Name = "Product"
        vDataTable.Columns.Item("CollectionsRate").Name = "Rate"
        vDataTable.Columns.Item("CollectionsBankAccount").Name = "BankAccount"
        Return vDataTable
      End Get
    End Property
#End Region

  End Class
End Namespace
